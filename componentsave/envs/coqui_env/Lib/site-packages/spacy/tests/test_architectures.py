import os, sys
sys.path.insert(0, os.path.abspath(os.path.join(os.path.dirname(__file__), '../..')))
import pytest
from componentsave.catalogue import RegistryError
from thinc.api import Linear

from componentsave.spacy import registry


def test_get_architecture():
    @registry.architectures("my_test_function")
    def create_model(nr_in, nr_out):
        return Linear(nr_in, nr_out)

    arch = registry.architectures.get("my_test_function")
    assert arch is create_model
    with pytest.raises(RegistryError):
        registry.architectures.get("not_an_existing_key")
